Index: app/src/main/java/sg/edu/np/mad/quizzzy/MainActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package sg.edu.np.mad.quizzzy;\r\n\r\nimport android.content.Intent;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.EdgeToEdge;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.appcompat.app.AppCompatDelegate;\r\nimport androidx.core.graphics.Insets;\r\nimport androidx.core.view.ViewCompat;\r\nimport androidx.core.view.WindowInsetsCompat;\r\n\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.firestore.DocumentReference;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.FieldValue;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\n\r\nimport java.util.List;\r\n\r\nimport sg.edu.np.mad.quizzzy.Models.SQLiteManager;\r\nimport sg.edu.np.mad.quizzzy.Models.User;\r\nimport sg.edu.np.mad.quizzzy.Models.UserWithRecents;\r\n\r\npublic class MainActivity extends AppCompatActivity {\r\n\r\n    private String flashletId = null;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        EdgeToEdge.enable(this);\r\n        setContentView(R.layout.activity_main);\r\n        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.splashTitle), (v, insets) -> {\r\n            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());\r\n            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);\r\n            return insets;\r\n        });\r\n        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO);\r\n\r\n        View loginBtn = findViewById(R.id.loginBtn);\r\n        View signupBtn = findViewById(R.id.signupBtn);\r\n\r\n        loginBtn.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(v.getContext(), LoginActivity.class);\r\n                if (flashletId != null) {\r\n                    intent.putExtra(\"FLASHLET_ID\", flashletId);\r\n                }\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n        signupBtn.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                Intent intent = new Intent(v.getContext(), SignupActivity.class);\r\n                if (flashletId != null) {\r\n                    intent.putExtra(\"FLASHLET_ID\", flashletId);\r\n                }\r\n                startActivity(intent);\r\n            }\r\n        });\r\n\r\n        handleIntent(getIntent());\r\n    }\r\n\r\n    @Override\r\n    protected void onNewIntent(Intent intent) {\r\n        super.onNewIntent(intent);\r\n        setIntent(intent);\r\n        handleIntent(intent);\r\n    }\r\n\r\n    private void handleIntent(Intent intent) {\r\n        Uri data = intent.getData();\r\n        if (data != null && data.isHierarchical()) {\r\n            flashletId = data.getQueryParameter(\"id\");\r\n\r\n            if (flashletId != null) {\r\n                if (FirebaseAuth.getInstance().getCurrentUser() != null) {\r\n                    handleFlashletAddition(flashletId);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n        if ((requestCode == 1 || requestCode == 2) && resultCode == RESULT_OK) {\r\n            String flashletId = data.getStringExtra(\"FLASHLET_ID\");\r\n            if (flashletId != null) {\r\n                handleFlashletAddition(flashletId);\r\n            }\r\n        }\r\n    }\r\n\r\n    private void handleFlashletAddition(String flashletId) {\r\n        FirebaseUser currentUser = FirebaseAuth.getInstance().getCurrentUser();\r\n        if (currentUser == null) {\r\n            Log.e(\"MainActivity\", \"User is not authenticated.\");\r\n            return;\r\n        }\r\n        String userId = currentUser.getUid();\r\n        FirebaseFirestore firebase = FirebaseFirestore.getInstance();\r\n\r\n        DocumentReference userRef = firebase.collection(\"users\").document(userId);\r\n        userRef.get().addOnCompleteListener(task -> {\r\n            if (task.isSuccessful()) {\r\n                DocumentSnapshot document = task.getResult();\r\n                if (document.exists()) {\r\n                    List<String> createdFlashlets = (List<String>) document.get(\"createdFlashlets\");\r\n                    if (createdFlashlets != null && createdFlashlets.contains(flashletId)) {\r\n                        Log.d(\"MainActivity\", \"Flashlet already exists in user createdFlashlets.\");\r\n                        Toast.makeText(MainActivity.this, \"You already have this flashlet.\", Toast.LENGTH_SHORT).show();\r\n                        navigateToHome(flashletId);\r\n                    } else {\r\n                        updateUserAndFlashlet(userRef, flashletId);\r\n                    }\r\n                }\r\n            } else {\r\n                Log.e(\"MainActivity\", \"Error checking user document\", task.getException());\r\n            }\r\n        });\r\n    }\r\n\r\n    private void updateUserAndFlashlet(DocumentReference userRef, String flashletId) {\r\n        FirebaseFirestore firebase = FirebaseFirestore.getInstance();\r\n        DocumentReference flashletRef = firebase.collection(\"flashlets\").document(flashletId);\r\n\r\n        userRef.update(\"createdFlashlets\", FieldValue.arrayUnion(flashletId))\r\n                .addOnSuccessListener(aVoid -> {\r\n                    Log.d(\"MainActivity\", \"Flashlet added to user successfully.\");\r\n                    Toast.makeText(MainActivity.this, \"Flashlet added successfully.\", Toast.LENGTH_SHORT).show();\r\n                })\r\n                .addOnFailureListener(e -> Log.e(\"MainActivity\", \"Error updating user\", e));\r\n\r\n        flashletRef.update(\"creatorID\", FieldValue.arrayUnion(userRef.getId()))\r\n                .addOnSuccessListener(aVoid -> navigateToHome(flashletId))\r\n                .addOnFailureListener(e -> Log.e(\"MainActivity\", \"Error updating flashlet\", e));\r\n    }\r\n\r\n\r\n    private void navigateToHome(String flashletId) {\r\n        Intent intent = new Intent(MainActivity.this, HomeActivity.class);\r\n        intent.putExtra(\"FLASHLET_ID\", flashletId);\r\n        startActivity(intent);\r\n    }\r\n\r\n    @Override\r\n    protected void onResume() {\r\n        super.onResume();\r\n\r\n        // Check if the User is Signed in to Quizzzy\r\n        SQLiteManager localDB = SQLiteManager.instanceOfDatabase(this);\r\n\r\n        UserWithRecents userWithRecents = localDB.getUser();\r\n        if (userWithRecents != null) {\r\n            User user = userWithRecents.getUser();\r\n            if (!user.getEmail().isEmpty() && !user.getUsername().isEmpty()) {\r\n                // User is Logged in, send to Home Screen\r\n                Intent homeScreenIntent = new Intent(MainActivity.this, HomeActivity.class);\r\n                startActivity(homeScreenIntent);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/sg/edu/np/mad/quizzzy/MainActivity.java b/app/src/main/java/sg/edu/np/mad/quizzzy/MainActivity.java
--- a/app/src/main/java/sg/edu/np/mad/quizzzy/MainActivity.java	(revision 76b5e0dc111f52254c9ec53a637208c3eea3d113)
+++ b/app/src/main/java/sg/edu/np/mad/quizzzy/MainActivity.java	(date 1722011979457)
@@ -21,6 +21,7 @@
 import com.google.firebase.firestore.FieldValue;
 import com.google.firebase.firestore.FirebaseFirestore;
 
+import java.util.ArrayList;
 import java.util.List;
 
 import sg.edu.np.mad.quizzzy.Models.SQLiteManager;
@@ -110,6 +111,8 @@
         }
         String userId = currentUser.getUid();
         FirebaseFirestore firebase = FirebaseFirestore.getInstance();
+        SQLiteManager localDB = SQLiteManager.instanceOfDatabase(MainActivity.this);
+
 
         DocumentReference userRef = firebase.collection("users").document(userId);
         userRef.get().addOnCompleteListener(task -> {
@@ -119,10 +122,14 @@
                     List<String> createdFlashlets = (List<String>) document.get("createdFlashlets");
                     if (createdFlashlets != null && createdFlashlets.contains(flashletId)) {
                         Log.d("MainActivity", "Flashlet already exists in user createdFlashlets.");
-                        Toast.makeText(MainActivity.this, "You already have this flashlet.", Toast.LENGTH_SHORT).show();
                         navigateToHome(flashletId);
+                        Toast.makeText(MainActivity.this, "You already have this flashlet.", Toast.LENGTH_SHORT).show();
                     } else {
                         updateUserAndFlashlet(userRef, flashletId);
+                        ArrayList<String> createdFlashletIds = localDB.getUser().getUser().getCreatedFlashlets();
+                        createdFlashletIds.add(flashletId);
+                        localDB.updateCreatedFlashcards(userId, createdFlashletIds);
+                        Toast.makeText(MainActivity.this, "Flashlet added successfully.", Toast.LENGTH_SHORT).show();
                     }
                 }
             } else {
